{% include "partials/todo_list_item.html" %}

<!-- Out-of-band update for title data when list is updated -->
<div id="title-data" 
     hx-swap-oob="true"
     data-list-name="{{ list.name }}" 
     data-incomplete-count="{{ list.todos | selectattr('is_completed', 'false') | list | length }}"
     style="display: none;"></div>

<!-- Out-of-band update for list header -->
<div class="list-content" id="list-content"
     hx-swap-oob="true"
     data-list-id="{{ list.id }}"
     data-list-name="{{ list.name | e }}"
     data-list-description="{{ (list.description or '') | e }}"
     data-list-color="{{ list.color }}">
    <div class="list-header">
        <div class="list-header-info">
            <div class="list-header-color" style="background-color: {{ list.color }}"></div>
            <div>
                <h2>{{ list.name }}</h2>
                {% if list.description %}
                <p class="list-header-description">{{ list.description }}</p>
                {% endif %}
            </div>
        </div>
        <div class="list-header-actions">
            <sl-icon-button name="pencil"
                            label="Edit list"
                            class="edit-list-header-btn"
                            onclick="openEditListDialog('{{ list.id }}', '{{ list.name | e }}', '{{ (list.description or '') | e }}', '{{ list.color }}')">
            </sl-icon-button>
            <sl-icon-button name="trash"
                            label="Delete list"
                            class="delete-list-header-btn danger-icon"
                            onclick="confirmDeleteList('{{ list.id }}', '{{ list.name | e }}')">
            </sl-icon-button>
        </div>
    </div>

    <!-- Search -->
    <div class="search-bar">
        <sl-input
            placeholder="Search todos..."
            clearable
            hx-get="/api/todos/search"
            hx-trigger="keyup changed delay:300ms, search"
            hx-target="#todos-list"
            hx-swap="innerHTML"
            hx-vals='{"list_id": "{{ list.id }}"}'
            name="q">
            <sl-icon slot="prefix" name="search"></sl-icon>
        </sl-input>
    </div>

    <!-- Quick add todo -->
    <form class="quick-add-form"
          hx-post="/api/todos"
          hx-target="#todos-list"
          hx-swap="beforeend"
          hx-on::after-request="if(event.detail.successful) this.reset()">
        <input type="hidden" name="list_id" value="{{ list.id }}">
        <sl-input
            name="title"
            placeholder="Add a new todo..."
            required
            maxlength="200">
            <sl-icon slot="prefix" name="plus-circle"></sl-icon>
        </sl-input>
        <sl-button type="submit" variant="primary">
            Add
        </sl-button>
    </form>

    <!-- Todos list -->
    <div id="todos-list" class="todos-list">
        {% for todo in list.todos %}
        {% include "partials/todo_item.html" %}
        {% endfor %}
    </div>
</div>
